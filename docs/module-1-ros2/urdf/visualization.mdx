---
sidebar_position: 6
title: Visualization in RViz
description: Visualizing and testing URDF robots in RViz
keywords: [ros2, urdf, rviz, visualization, joint state publisher]
---

# Visualization in RViz

Learn to visualize, test, and debug URDF robot models using RViz.

## What is RViz?

:::tip Definition

**RViz** (ROS Visualization) is a 3D visualization tool for displaying sensor data, robot state, and more in real-time.

:::

**RViz can display**:
- Robot models (URDF)
- Sensor data (cameras, lasers, point clouds)
- Transforms (TF tree)
- Markers and trajectories
- Maps and navigation paths

## Package Structure

```
my_robot_description/
├── urdf/
│   └── my_robot.urdf
├── launch/
│   └── display.launch.py
├── config/
│   └── display.rviz
├── meshes/
├── package.xml
└── CMakeLists.txt
```

## Launch File

**launch/display.launch.py**:

```python
import os
from launch import LaunchDescription
from launch.actions import DeclareLaunchArgument
from launch.substitutions import LaunchConfiguration
from launch_ros.actions import Node
from ament_index_python.packages import get_package_share_directory

def generate_launch_description():
    pkg_dir = get_package_share_directory('my_robot_description')
    urdf_file = os.path.join(pkg_dir, 'urdf', 'my_robot.urdf')
    rviz_config = os.path.join(pkg_dir, 'config', 'display.rviz')

    use_gui = LaunchConfiguration('use_gui', default='true')

    with open(urdf_file, 'r') as file:
        robot_description = file.read()

    return LaunchDescription([
        DeclareLaunchArgument('use_gui', default_value='true',
                              description='Use joint state publisher GUI'),

        # Robot State Publisher
        Node(
            package='robot_state_publisher',
            executable='robot_state_publisher',
            output='screen',
            parameters=[{'robot_description': robot_description}]
        ),

        # Joint State Publisher GUI
        Node(
            package='joint_state_publisher_gui',
            executable='joint_state_publisher_gui',
            output='screen',
            condition=launch.conditions.IfCondition(use_gui)
        ),

        # RViz
        Node(
            package='rviz2',
            executable='rviz2',
            output='screen',
            arguments=['-d', rviz_config]
        )
    ])
```

### Running

```bash
cd ~/ros2_ws
colcon build --packages-select my_robot_description
source install/setup.bash

# Launch visualization
ros2 launch my_robot_description display.launch.py

# Launch without GUI
ros2 launch my_robot_description display.launch.py use_gui:=false
```

## Joint State Publisher GUI

Provides sliders to control joint angles:

```
┌─────────────────────────────────┐
│  Joint State Publisher          │
├─────────────────────────────────┤
│  left_shoulder_pitch   [slider] │
│  left_elbow            [slider] │
│  right_shoulder_pitch  [slider] │
│  [ Center ]  [ Random ]          │
└─────────────────────────────────┘
```

**Features**:
- Sliders for each joint
- Respects joint limits
- Center/Random buttons

## RViz Configuration

### Basic Setup

1. **Add Robot Model**:
   - Add → RobotModel
   - Description Topic: `/robot_description`

2. **Add TF**:
   - Add → TF
   - Shows all coordinate frames

3. **Set Fixed Frame**:
   - Global Options → Fixed Frame: `base_link`

4. **Save Configuration**:
   - File → Save Config As → `config/display.rviz`

### Configuration File

**config/display.rviz** (simplified):

```yaml
Visualization Manager:
  Global Options:
    Fixed Frame: base_link
    Frame Rate: 30

  Displays:
    - Class: rviz_default_plugins/RobotModel
      Robot Description: robot_description
      Visual Enabled: true
      Collision Enabled: false

    - Class: rviz_default_plugins/TF
      Show Axes: true
      Show Names: true
      Frame Timeout: 15

    - Class: rviz_default_plugins/Grid
      Plane: XY
      Cell Size: 1.0
```

## RViz Display Types

### 1. RobotModel

Shows the robot from URDF:
- Visual geometry (appearance)
- Collision geometry (physics)
- Toggle both

### 2. TF (Transform Frames)

Visualizes coordinate frames:
- Shows all frames in tree
- Direction indicators
- Frame labels

### 3. Grid

Reference grid on ground for scale.

### 4. Axes

Shows X/Y/Z axes at a frame.

## Testing URDF Checklist

✅ **Robot appears**: Model loads
✅ **Correct colors**: Materials applied
✅ **Proper orientation**: Z-axis up
✅ **Joints move**: Sliders work
✅ **Joint limits**: Can't exceed limits
✅ **TF tree complete**: All frames connected

## Common Issues

### Robot doesn't appear

**Solutions**:
```bash
# Check URDF syntax
check_urdf my_robot.urdf

# Verify robot_state_publisher
ros2 node list | grep robot_state_publisher

# Check topic
ros2 topic echo /robot_description --once
```

### Robot appears white

**Cause**: Materials not defined

**Solution**: Add materials in URDF:
```xml
<material name="blue">
  <color rgba="0 0 1 1"/>
</material>
```

### Joints don't move

**Solution**:
```bash
# Check joint states
ros2 topic echo /joint_states

# Verify joint types
grep 'type="' my_robot.urdf
```

## Publishing Joint States Programmatically

```python
#!/usr/bin/env python3

import rclpy
from rclpy.node import Node
from sensor_msgs.msg import JointState
import math

class JointStatePublisher(Node):
    def __init__(self):
        super().__init__('joint_state_publisher')
        self.publisher = self.create_publisher(JointState, 'joint_states', 10)
        self.timer = self.create_timer(0.02, self.publish_joint_states)

        self.joint_names = ['left_shoulder_pitch', 'left_elbow']
        self.time = 0.0

    def publish_joint_states(self):
        msg = JointState()
        msg.header.stamp = self.get_clock().now().to_msg()
        msg.name = self.joint_names

        # Animate wave motion
        wave = math.sin(2 * math.pi * 0.5 * self.time)
        msg.position = [wave, -0.5]

        self.publisher.publish(msg)
        self.time += 0.02

def main(args=None):
    rclpy.init(args=args)
    node = JointStatePublisher()
    rclpy.spin(node)
    node.destroy_node()
    rclpy.shutdown()
```

## Markers for Debugging

```python
from visualization_msgs.msg import Marker

def publish_marker(self):
    marker = Marker()
    marker.header.frame_id = "base_link"
    marker.header.stamp = self.get_clock().now().to_msg()
    marker.type = Marker.SPHERE
    marker.action = Marker.ADD

    # Position
    marker.pose.position.x = 1.0
    marker.pose.orientation.w = 1.0

    # Scale
    marker.scale.x = 0.1
    marker.scale.y = 0.1
    marker.scale.z = 0.1

    # Color (RGBA)
    marker.color.r = 1.0
    marker.color.a = 1.0

    self.marker_pub.publish(marker)
```

**Add to RViz**: Add → Marker → Topic: `/visualization_marker`

## Best Practices

:::tip RViz Best Practices

1. **Save configs** - Don't reconfigure every time
2. **Fixed frame** - Choose stable frame (`base_link`)
3. **Reduce clutter** - Disable unused displays
4. **Name displays** - Rename for clarity
5. **Grid reference** - Enable for scale
6. **Performance** - Disable expensive displays if laggy
7. **Documentation** - Note what each config is for

:::

## Debugging Workflow

When URDF doesn't work:

1. **Validate syntax**
   ```bash
   check_urdf my_robot.urdf
   ```

2. **Visualize tree**
   ```bash
   urdf_to_graphviz my_robot.urdf
   evince my_robot.pdf
   ```

3. **Check TF tree**
   ```bash
   ros2 run tf2_tools view_frames
   ```

4. **Monitor topics**
   ```bash
   ros2 topic list
   ros2 topic echo /robot_description
   ros2 topic echo /joint_states
   ```

5. **Test incrementally** - Add one link at a time

## Key Takeaways

:::note Summary

- **RViz** is ROS 2's 3D visualization tool
- **robot_state_publisher** broadcasts robot state and TF
- **joint_state_publisher_gui** provides control sliders
- **Launch files** start all nodes together
- **RViz configs** save display settings
- **Display types**: RobotModel, TF, Markers, Grid
- **Fixed frame**: Choose stable reference
- **Debugging**: check_urdf, view_frames, topic echoes
- **Save configs** for reusability

:::

---

**Next**: Module 2 Coming Soon!

**Previous**: [← Humanoid Robot URDF](./humanoid-urdf)
