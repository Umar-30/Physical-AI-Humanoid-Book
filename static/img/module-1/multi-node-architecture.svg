<svg width="900" height="550" xmlns="http://www.w3.org/2000/svg">
  <!-- Title -->
  <text x="450" y="30" font-size="20" font-weight="bold" text-anchor="middle" fill="#333">Multi-Node System Architecture</text>
  <text x="450" y="52" font-size="12" text-anchor="middle" fill="#666">sensor_node → planner_node → controller_node</text>

  <!-- Sensor Node -->
  <ellipse cx="150" cy="200" rx="90" ry="60" fill="#e3f2fd" stroke="#1976d2" stroke-width="2"/>
  <text x="150" y="190" font-size="14" font-weight="bold" text-anchor="middle" fill="#1565c0">/sensor_node</text>
  <text x="150" y="210" font-size="10" text-anchor="middle" fill="#555">Publisher</text>
  <text x="150" y="225" font-size="9" text-anchor="middle" fill="#666">Simulates lidar</text>

  <!-- Topic: /scan -->
  <rect x="280" y="175" width="110" height="50" fill="#fff3e0" stroke="#f57c00" stroke-width="1" rx="4"/>
  <text x="335" y="195" font-size="11" font-weight="bold" text-anchor="middle" fill="#e65100">Topic:</text>
  <text x="335" y="212" font-size="10" text-anchor="middle" fill="#e65100">/scan</text>

  <!-- Arrow: sensor → topic -->
  <defs>
    <marker id="arrowMulti" markerWidth="8" markerHeight="8" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#666" />
    </marker>
  </defs>
  <line x1="240" y1="200" x2="280" y2="200" stroke="#666" stroke-width="2" marker-end="url(#arrowMulti)"/>

  <!-- Planner Node -->
  <ellipse cx="540" cy="200" rx="90" ry="60" fill="#e8f5e9" stroke="#388e3c" stroke-width="2"/>
  <text x="540" y="185" font-size="14" font-weight="bold" text-anchor="middle" fill="#2e7d32">/planner_node</text>
  <text x="540" y="205" font-size="10" text-anchor="middle" fill="#555">Subscriber</text>
  <text x="540" y="220" font-size="10" text-anchor="middle" fill="#555">Service Server</text>

  <!-- Arrow: topic → planner -->
  <line x1="390" y1="200" x2="450" y2="200" stroke="#666" stroke-width="2" marker-end="url(#arrowMulti)"/>

  <!-- Service: /get_plan -->
  <rect x="545" y="305" width="135" height="60" fill="#bbdefb" stroke="#1976d2" stroke-width="2" rx="4"/>
  <text x="612" y="325" font-size="11" font-weight="bold" text-anchor="middle" fill="#1565c0">Service:</text>
  <text x="612" y="345" font-size="10" text-anchor="middle" fill="#1565c0">/get_plan</text>
  <text x="612" y="360" font-size="9" text-anchor="middle" fill="#666">(Request/Response)</text>

  <!-- Arrow: planner → service -->
  <line x1="540" y1="260" x2="540" y2="285" stroke="#666" stroke-width="2"/>
  <line x1="540" y1="285" x2="580" y2="305" stroke="#666" stroke-width="2" marker-end="url(#arrowMulti)"/>

  <!-- Controller Node -->
  <ellipse cx="750" cy="200" rx="90" ry="60" fill="#f3e5f5" stroke="#7b1fa2" stroke-width="2"/>
  <text x="750" y="185" font-size="14" font-weight="bold" text-anchor="middle" fill="#6a1b9a">/controller_node</text>
  <text x="750" y="205" font-size="10" text-anchor="middle" fill="#555">Service Client</text>
  <text x="750" y="220" font-size="10" text-anchor="middle" fill="#555">Action Server</text>

  <!-- Arrow: service → controller -->
  <line x1="647" y1="335" x2="695" y2="240" stroke="#666" stroke-width="2" stroke-dasharray="4,4" marker-end="url(#arrowMulti)"/>
  <text x="670" y="280" font-size="9" fill="#666" transform="rotate(-25 670 280)">calls</text>

  <!-- Action: /navigate -->
  <rect x="675" y="405" width="150" height="70" fill="#c8e6c9" stroke="#388e3c" stroke-width="2" rx="4"/>
  <text x="750" y="428" font-size="11" font-weight="bold" text-anchor="middle" fill="#2e7d32">Action:</text>
  <text x="750" y="448" font-size="10" text-anchor="middle" fill="#2e7d32">/navigate</text>
  <text x="750" y="465" font-size="9" text-anchor="middle" fill="#666">(Goal/Feedback/Result)</text>

  <!-- Arrow: controller → action -->
  <line x1="750" y1="260" x2="750" y2="405" stroke="#666" stroke-width="2" marker-end="url(#arrowMulti)"/>

  <!-- Action Client Box -->
  <rect x="480" y="430" width="120" height="40" fill="#ffebee" stroke="#d32f2f" stroke-width="1" rx="3"/>
  <text x="540" y="445" font-size="10" font-weight="bold" text-anchor="middle" fill="#c62828">External Client</text>
  <text x="540" y="462" font-size="9" text-anchor="middle" fill="#666">(sends goals)</text>

  <!-- Arrow: external client → action -->
  <line x1="600" y1="450" x2="675" y2="440" stroke="#d32f2f" stroke-width="2" stroke-dasharray="4,4" marker-end="url(#arrowMulti)"/>

  <!-- Data Flow Description -->
  <rect x="50" y="380" width="380" height="150" fill="#f5f5f5" stroke="#999" stroke-width="1" rx="5"/>
  <text x="240" y="405" font-size="13" font-weight="bold" text-anchor="middle" fill="#333">Data Flow</text>

  <text x="60" y="430" font-size="11" fill="#333" font-weight="bold">1. Sensor publishes:</text>
  <text x="70" y="448" font-size="10" fill="#555">→ Lidar scans on /scan topic at 10 Hz</text>

  <text x="60" y="470" font-size="11" fill="#333" font-weight="bold">2. Planner subscribes & serves:</text>
  <text x="70" y="488" font-size="10" fill="#555">→ Receives /scan data</text>
  <text x="70" y="503" font-size="10" fill="#555">→ Provides /get_plan service</text>

  <text x="60" y="522" font-size="11" fill="#333" font-weight="bold">3. Controller executes:</text>
  <text x="70" y="540" font-size="10" fill="#555">→ Calls /get_plan service</text>
  <text x="70" y="555" font-size="10" fill="#555">→ Executes /navigate action with feedback</text>

  <!-- Legend -->
  <rect x="480" y="90" width="380" height="80" fill="white" stroke="#999" stroke-width="1" rx="4"/>
  <text x="670" y="110" font-size="12" font-weight="bold" text-anchor="middle" fill="#333">Communication Patterns</text>

  <rect x="495" y="120" width="75" height="25" fill="#fff3e0" stroke="#f57c00" stroke-width="1" rx="2"/>
  <text x="532" y="137" font-size="9" text-anchor="middle" fill="#e65100">Topic</text>

  <rect x="585" y="120" width="75" height="25" fill="#bbdefb" stroke="#1976d2" stroke-width="1" rx="2"/>
  <text x="622" y="137" font-size="9" text-anchor="middle" fill="#1565c0">Service</text>

  <rect x="675" y="120" width="75" height="25" fill="#c8e6c9" stroke="#388e3c" stroke-width="1" rx="2"/>
  <text x="712" y="137" font-size="9" text-anchor="middle" fill="#2e7d32">Action</text>

  <line x1="765" y1="132" x2="810" y2="132" stroke="#666" stroke-width="2" marker-end="url(#arrowMulti)"/>
  <text x="845" y="137" font-size="9" fill="#666">Data flow</text>
</svg>
